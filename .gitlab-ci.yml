# General #####################################################################

stages:
  - lint
  - test

variables:
  ALLOWED_HOSTS: localhost
  POSTGRES_HOST: postgres
  POSTGRES_PORT: 5432
  POSTGRES_DB: web_template
  POSTGRES_USER: postgres
  POSTGRES_PASSWORD: postgres
  DEBUG: false
  SECRET_KEY: test

# Docs ########################################################################

lint docs:
  stage: lint
  image: node:latest
  script:
    - npm install markdownlint-cli
    - npx markdownlint docs

# Backend #####################################################################

.backend:
  stage: test
  image: docker/compose:1.29.2
  tags:
    - docker
  services:
    - docker:dind
    - postgres:12.6
    - redis:5.0
  before_script:
    - apk update && apk add make
    - make migrate

pytest:
  extends: .backend
  script: make test
